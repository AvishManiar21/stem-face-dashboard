
# Add this to app/admin/routes.py at the end

@admin_bp.route('/api/dashboard-stats')
def api_dashboard_stats():
    """Get dashboard statistics for the unified dashboard"""
    user, redirect_response = require_admin_access()
    if redirect_response or not user:
        return jsonify({'error': 'Unauthorized'}), 401
    
    try:
        import pandas as pd
        import os
        
        stats = {
            'total_tutors': 0,
            'active_courses': 0,
            'appointments_today': 0,
            'total_users': 0
        }
        
        # Count tutors
        tutors_file = 'data/core/tutors.csv'
        if os.path.exists(tutors_file):
            df = pd.read_csv(tutors_file)
            stats['total_tutors'] = len(df[df.get('active', True) == True]) if 'active' in df.columns else len(df)
        
        # Count courses
        courses_file = 'data/core/courses.csv'
        if os.path.exists(courses_file):
            df = pd.read_csv(courses_file)
            stats['active_courses'] = len(df[df.get('active', True) == True]) if 'active' in df.columns else len(df)
        
        # Count today's appointments
        appointments_file = 'data/core/appointments.csv'
        if os.path.exists(appointments_file):
            df = pd.read_csv(appointments_file)
            if not df.empty and 'appointment_date' in df.columns:
                from datetime import datetime
                today = datetime.now().strftime('%Y-%m-%d')
                stats['appointments_today'] = len(df[df['appointment_date'] == today])
        
        # Count users
        users_file = 'logs/users.csv'
        if os.path.exists(users_file):
            df = pd.read_csv(users_file)
            stats['total_users'] = len(df[df.get('active', True) == True]) if 'active' in df.columns else len(df)
        
        return jsonify(stats)
    except Exception as e:
        return jsonify({'error': str(e)}), 500
